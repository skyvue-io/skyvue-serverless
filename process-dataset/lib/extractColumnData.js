// const unparsedData = `taxi_id,trip_start_timestamp,trip_end_timestamp,trip_seconds,trip_miles,pickup_census_tract,dropoff_census_tract,pickup_community_area,dropoff_community_area,fare,tips,tolls,extras,trip_total,payment_type,company,pickup_latitude,pickup_longitude,dropoff_latitude,dropoff_longitude
// 85,2016-1-13 06:15:00,2016-1-13 06:15:00,180,0.4,,,24,24,4.50,0.00,0.00,0.00,4.50,Cash,107,199,510,199,510
// 2776,2016-1-22 09:30:00,2016-1-22 09:45:00,240,0.7,,,,,4.45,4.45,0.00,0.00,8.90,Credit Card,,,,,
// 3168,2016-1-31 21:30:00,2016-1-31 21:30:00,0,0,,,,,42.75,5.00,0.00,0.00,47.75,Credit Card,119,,,,
// 4237,2016-1-23 17:30:00,2016-1-23 17:30:00,480,1.1,,,6,6,7.00,0.00,0.00,0.00,7.00,Cash,,686,500,686,500
// 5710,2016-1-14 05:45:00,2016-1-14 06:00:00,480,2.71,,,32,,10.25,0.00,0.00,0.00,10.25,Cash,,385,478,,
// 1987,2016-1-8 18:15:00,2016-1-8 18:45:00,1080,6.2,,,8,3,17.75,0.00,0.00,0.00,17.75,Cash,,599,346,660,120
// 4986,2016-1-14 04:30:00,2016-1-14 05:00:00,1500,18.4,,,,,45.00,12.00,0.00,0.00,57.00,Credit Card,,,,,
// 6400,2016-1-26 04:15:00,2016-1-26 04:15:00,60,0.2,,,16,16,3.75,0.00,0.00,0.00,3.75,Cash,107,527,24,527,24
// 7418,2016-1-22 11:30:00,2016-1-22 11:45:00,180,0,,504,8,32,5.00,2.00,0.00,1.50,8.50,Credit Card,82,210,470,744,605
// 6450,2016-1-7 21:15:00,2016-1-7 21:15:00,0,0,,,,,3.25,0.00,0.00,1.50,4.75,Cash,,,,,
// 1078,2016-1-25 09:00:00,2016-1-25 09:00:00,480,1.3,,792,8,8,7.00,1.00,0.00,0.00,8.00,Credit Card,109,161,649,419,615
// 6641,2016-1-6 23:15:00,2016-1-6 23:30:00,420,0,,807,8,28,7.25,0.00,0.00,0.00,7.25,Cash,8,419,615,411,545
// 920,2016-1-13 18:30:00,2016-1-13 19:00:00,1380,5.1,,,32,31,17.25,5.18,0.00,0.00,22.43,Credit Card,,385,478,558,388
// 7984,2016-1-22 09:45:00,2016-1-22 09:45:00,420,0,,749,8,28,6.25,0.00,0.00,0.00,6.25,Cash,107,419,615,681,196
// 6078,2016-1-3 07:45:00,2016-1-3 08:00:00,480,0.1,,,41,69,9.00,0.00,0.00,0.00,9.00,Cash,107,583,195,278,173
// 221,2016-1-3 16:30:00,2016-1-3 16:30:00,720,0,,807,7,28,10.75,0.00,0.00,0.00,10.75,Cash,101,642,32,411,545
// 6535,2016-1-25 10:30:00,2016-1-25 10:30:00,720,2.2,,40,7,28,10.00,0.00,0.00,0.00,10.00,Cash,92,618,407,395,408
// 5292,2016-1-29 08:15:00,2016-1-29 08:30:00,300,0.8,,,,,5.50,0.00,0.00,0.00,5.50,Cash,,,,,
// 5367,2016-1-11 14:00:00,2016-1-11 14:00:00,420,0,,,28,28,6.75,0.00,0.00,0.00,6.75,Cash,107,158,270,158,270
// 4251,2016-1-1 19:30:00,2016-1-1 19:45:00,660,4.1,,404,8,6,11.85,3.00,0.00,1.00,15.85,Credit Card,101,210,470,606,617
// 3428,2016-1-20 07:30:00,2016-1-20 07:45:00,720,2.5,,749,8,28,10.25,1.75,0.00,0.00,12.00,Credit Card,,167,754,681,196
// 5132,2016-1-8 19:30:00,2016-1-8 19:30:00,720,0.2,,108,32,24,12.25,2.00,0.00,1.00,15.25,Credit Card,8,18,610,472,207
// 8414,2016-1-2 13:30:00,2016-1-2 13:30:00,0,0,,,3,3,3.25,0.00,0.00,0.00,3.25,Cash,,660,120,660,120
// 2647,2016-1-15 19:30:00,2016-1-15 19:30:00,360,0,,13,8,8,6.50,0.00,0.00,0.00,6.50,Cash,107,754,410,474,204
// 2628,2016-1-19 11:15:00,2016-1-19 11:15:00,0,0,,,,,10.75,2.69,0.00,0.00,13.44,Credit Card,119,,,,
// 8613,2016-1-14 14:15:00,2016-1-14 14:45:00,1740,11.5,,960,32,56,31.25,0.00,0.00,4.00,35.25,Cash,,18,610,433,757
// 4126,2016-1-23 21:45:00,2016-1-23 21:45:00,360,0,,504,8,32,6.00,0.00,0.00,0.00,6.00,Cash,101,688,206,744,605
// 3102,2016-1-17 21:00:00,2016-1-17 21:00:00,0,0,,,,,22.00,1.50,0.00,0.00,23.50,Credit Card,119,,,,
// 4488,2016-1-23 21:00:00,2016-1-23 21:30:00,2040,17.4,,,8,,44.75,8.95,0.00,0.00,53.70,Credit Card,,599,346,,
// 146,2016-1-17 01:00:00,2016-1-17 01:00:00,180,0.7,,,,,5.00,2.00,0.00,0.00,7.00,Credit Card,109,,,,
// 373,2016-1-2 17:45:00,2016-1-2 17:45:00,240,0.6,,504,8,32,4.85,0.00,0.00,1.50,6.35,Cash,109,688,206,744,605
// 5540,2016-1-13 19:00:00,2016-1-13 19:15:00,600,0.9,,959,8,8,7.00,1.11,0.00,0.00,8.11,Credit Card,92,754,410,167,754
// 2913,2016-1-12 15:30:00,2016-1-12 15:45:00,840,0.4,,,41,8,20.00,2.00,0.00,0.00,22.00,Credit Card,107,583,195,599,346
// 5680,2016-1-1 14:30:00,2016-1-1 14:45:00,1020,7.8,,,8,4,18.85,0.00,0.00,0.00,18.85,Cash,10,599,346,399,780
// 4545,2016-1-1 00:00:00,2016-1-1 00:00:00,0,0,,179,32,32,0.00,0.00,0.00,0.00,0.00,Cash,119,30,405,30,405
// 5391,2016-1-13 05:30:00,2016-1-13 05:30:00,420,2.8,,,32,28,9.50,0.00,0.00,0.00,9.50,Cash,,385,478,158,270
// 5901,2016-1-16 02:45:00,2016-1-16 02:45:00,360,0,,1077,8,7,7.00,2.00,0.00,1.00,10.00,Credit Card,107,695,366,724,47
// 4316,2016-1-21 20:30:00,2016-1-21 20:45:00,360,1.3,,16,8,32,6.50,2.00,0.00,0.00,8.50,Credit Card,,210,470,18,610
// 6468,2016-1-14 11:45:00,2016-1-14 11:45:00,540,0.78,,504,32,32,7.00,0.00,0.00,1.00,8.00,Cash,,64,231,744,605
// 3329,2016-1-11 09:30:00,2016-1-11 09:30:00,0,0,,,21,21,3.25,0.65,0.00,0.00,3.90,Unknown,107,95,781,95,781
// 8102,2016-1-18 15:45:00,2016-1-18 16:00:00,480,1.6,,805,32,8,7.75,0.00,0.00,0.00,7.75,Cash,107,64,231,526,511
// 3786,2016-1-26 14:00:00,2016-1-26 14:00:00,180,0.6,,805,8,8,4.75,0.00,0.00,0.00,4.75,Cash,,210,470,526,511
// 2862,2016-1-12 21:45:00,2016-1-12 21:45:00,0,0,,,24,24,3.25,0.00,0.00,0.00,3.25,Cash,10,199,510,199,510
// 7145,2016-1-15 13:15:00,2016-1-15 13:15:00,360,0.9,,792,32,8,6.25,2.00,0.00,0.00,8.25,Credit Card,92,744,605,419,615
// 7744,2016-1-13 16:00:00,2016-1-13 16:00:00,120,0.2,,787,8,8,4.00,0.00,0.00,1.00,5.00,Cash,107,167,754,161,649
// 8191,2016-1-19 08:30:00,2016-1-19 08:30:00,480,0,,16,33,32,8.50,2.00,0.00,0.00,10.50,Credit Card,8,728,277,18,610
// 1727,2016-1-12 17:45:00,2016-1-12 18:00:00,720,1.3,,,,,9.00,1.00,0.00,0.00,10.00,Credit Card,,,,,
// 6907,2016-1-7 16:00:00,2016-1-7 16:00:00,420,1.4,,13,32,8,7.00,0.00,0.00,0.00,7.00,Cash,,744,605,474,204
// 8162,2016-1-14 18:15:00,2016-1-14 19:00:00,2880,17.3,,16,76,32,43.50,9.50,0.00,4.00,57.00,Credit Card,,225,6,18,610
// 8618,2016-1-16 03:00:00,2016-1-16 03:00:00,420,0,,787,8,8,7.00,0.00,0.00,2.00,9.00,Cash,8,754,410,161,649
// 5178,2016-1-23 23:15:00,2016-1-23 23:30:00,960,3.5,,,,,12.50,0.00,0.00,1.00,13.50,Cash,,,,,
// 8247,2016-1-2 17:00:00,2016-1-2 17:00:00,360,0.9,,134,8,24,6.25,0.00,0.00,0.00,6.25,Cash,101,754,410,45,163
// 8591,2016-1-3 03:30:00,2016-1-3 03:45:00,360,1.2,,16,8,32,6.50,2.00,0.00,1.00,9.50,Credit Card,101,695,366,18,610
// 4751,2016-1-4 11:15:00,2016-1-4 11:15:00,360,0.8,,911,8,8,5.45,1.00,0.00,0.00,6.45,Credit Card,82,167,754,688,206
// 2438,2016-1-6 01:30:00,2016-1-6 01:45:00,900,5.5,,,,20,15.25,0.00,0.00,0.00,15.25,Cash,,,,310,245
// 5209,2016-1-14 16:00:00,2016-1-14 16:00:00,480,1.2,,,,,7.00,1.00,0.00,0.00,8.00,Credit Card,,,,,
// 1005,2016-1-1 22:15:00,2016-1-1 22:30:00,540,3.8,,,33,24,10.85,0.00,0.00,1.50,12.35,Cash,109,438,199,199,510
// 746,2016-1-18 14:15:00,2016-1-18 15:00:00,2940,21.1,,515,76,33,52.25,0.00,0.00,4.00,56.25,Cash,,225,6,529,619
// 7271,2016-1-8 10:00:00,2016-1-8 10:15:00,420,1.3,,504,28,32,6.75,0.00,0.00,1.00,7.75,Cash,3,411,545,744,605
// 6075,2016-1-10 02:45:00,2016-1-10 02:45:00,240,0.9,,504,8,32,5.50,0.00,0.00,1.00,6.50,Cash,,170,351,744,605
// 7837,2016-1-24 19:00:00,2016-1-24 19:45:00,2100,13.6,,,76,77,36.25,8.05,0.00,4.00,48.30,Credit Card,109,575,547,556,288
// 7056,2016-1-12 20:30:00,2016-1-12 20:30:00,0,0,,,,,15.75,3.94,0.00,0.00,19.69,Credit Card,119,,,,
// 5810,2016-1-21 19:15:00,2016-1-21 19:15:00,240,0.87,,40,32,28,5.50,2.00,0.00,0.00,7.50,Credit Card,,18,610,395,408
// 5258,2016-1-14 09:15:00,2016-1-14 09:30:00,480,1.4,,16,8,32,7.25,0.00,0.00,0.00,7.25,Cash,,474,204,18,610
// 3567,2016-1-5 09:15:00,2016-1-5 09:45:00,1020,1.4,,16,8,32,11.25,0.00,0.00,0.00,11.25,Cash,,167,754,18,610
// 65,2016-1-13 19:15:00,2016-1-13 19:30:00,660,2.1,,,,,9.00,0.00,0.00,0.00,9.00,Cash,,,,,
// 1474,2016-1-22 17:15:00,2016-1-22 17:45:00,1320,5.7,,,8,5,18.75,3.75,0.00,0.00,22.50,Credit Card,,599,346,109,708
// 2924,2016-1-9 23:15:00,2016-1-9 23:15:00,780,4.5,,694,8,7,14.00,0.00,0.00,1.00,15.00,Cash,,170,351,595,671
// 433,2016-1-5 21:45:00,2016-1-5 21:45:00,0,0,,,28,28,3.25,5.00,0.00,9.00,17.25,Credit Card,109,158,270,158,270
// 4605,2016-1-18 15:15:00,2016-1-18 15:15:00,300,0.5,,970,8,8,5.25,0.00,0.00,4.00,9.25,Cash,107,294,113,210,470
// 2353,2016-1-3 02:30:00,2016-1-3 02:30:00,0,0,,,,,8.00,0.00,0.00,0.00,8.00,Credit Card,68,,,,
// 8353,2016-1-12 17:30:00,2016-1-12 17:45:00,720,1.5,,13,32,8,8.75,0.00,0.00,0.00,8.75,Cash,,744,605,474,204
// 1748,2016-1-21 19:30:00,2016-1-21 19:30:00,360,0,,899,32,8,6.25,0.00,0.00,1.00,7.25,Cash,8,18,610,170,351
// 6046,2016-1-9 23:15:00,2016-1-9 23:45:00,1560,9.7,,,28,1,27.25,0.00,0.00,1.00,28.25,Cash,,158,270,37,370
// 1671,2016-1-7 19:30:00,2016-1-7 20:00:00,1560,6.9,,,32,6,21.25,3.00,0.00,0.00,24.25,Credit Card,6,385,478,686,500
// 7215,2016-1-9 02:45:00,2016-1-9 02:45:00,420,1.7,,,,,7.50,0.00,0.00,0.00,7.50,Cash,92,,,,
// 5272,2016-1-20 21:00:00,2016-1-20 21:00:00,540,200,,807,8,28,8.75,2.00,0.00,0.00,10.75,Credit Card,,294,113,411,545
// 8285,2016-1-2 22:15:00,2016-1-2 22:15:00,180,0,,,22,22,5.25,0.00,0.00,0.00,5.25,Cash,107,604,668,604,668
// 6628,2016-1-26 23:00:00,2016-1-26 23:15:00,960,7.6,,,8,4,21.00,0.00,0.00,0.00,21.00,Cash,107,599,346,399,780
// 7152,2016-1-29 18:30:00,2016-1-29 18:30:00,0,0,,,,,12.25,2.45,0.00,0.00,14.70,Credit Card,119,,,,
// 2043,2016-1-12 10:30:00,2016-1-12 10:45:00,660,1,,307,32,32,7.50,2.00,0.00,1.00,10.50,Credit Card,101,18,610,64,231
// 7310,2016-1-25 21:45:00,2016-1-25 21:45:00,300,1,,911,8,8,6.00,0.00,0.00,0.00,6.00,Cash,,695,366,688,206
// 7152,2016-1-22 17:15:00,2016-1-22 17:15:00,0,0,,,,,4.25,1.06,0.00,0.00,5.31,Credit Card,119,,,,
// 6016,2016-1-11 23:30:00,2016-1-11 23:30:00,0,0,,313,76,76,3.25,0.00,0.00,0.00,3.25,Cash,8,225,6,225,6
// 734,2016-1-24 06:15:00,2016-1-24 06:30:00,420,0,,,6,6,6.25,0.00,0.00,1.00,7.25,Credit Card,8,686,500,686,500
// 2979,2016-1-23 20:45:00,2016-1-23 21:00:00,900,3.8,,,24,6,13.00,0.00,0.00,0.00,13.00,Cash,,199,510,686,500
// 6088,2016-1-12 08:15:00,2016-1-12 08:30:00,360,0.8,,307,28,32,5.75,0.00,0.00,0.00,5.75,Cash,109,411,545,64,231
// 2331,2016-1-22 00:00:00,2016-1-22 00:15:00,600,5.5,,,8,21,16.50,0.00,0.00,0.00,16.50,Cash,101,599,346,95,781
// 2147,2016-1-15 10:00:00,2016-1-15 10:15:00,900,7,,,43,35,20.25,2.00,0.00,0.00,22.25,Credit Card,107,422,594,716,107
// 4298,2016-1-5 02:30:00,2016-1-5 02:45:00,300,0,,,28,8,6.50,0.00,0.00,0.00,6.50,Cash,107,158,270,599,346
// 2542,2016-1-20 17:15:00,2016-1-20 17:15:00,0,0,,,,,14.25,2.85,0.00,0.00,17.10,Credit Card,119,,,,
// 5018,2016-1-12 13:30:00,2016-1-12 13:30:00,720,3.7,,,8,24,12.50,2.50,0.00,0.00,15.00,Credit Card,,599,346,199,510
// 1603,2016-1-8 22:00:00,2016-1-8 22:15:00,900,0.3,,37,8,4,18.00,3.60,0.00,0.00,21.60,Credit Card,107,695,366,251,260
// 8169,2016-1-19 17:30:00,2016-1-19 18:15:00,2760,18.3,,16,76,32,46.25,10.05,0.00,4.00,60.30,Credit Card,109,225,6,18,610
// 8394,2016-1-17 07:45:00,2016-1-17 08:00:00,420,1.9,,807,8,28,8.25,2.00,0.00,1.00,11.25,Credit Card,,688,206,411,545
// 6535,2016-1-9 11:15:00,2016-1-9 11:30:00,1500,18.2,,313,32,76,45.25,0.00,0.00,1.00,46.25,Cash,92,744,605,225,6
// 3047,2016-1-17 19:15:00,2016-1-17 19:15:00,0,0,,,,,6.75,1.35,0.00,0.00,8.10,Credit Card,119,,,,
// 7330,2016-1-23 09:15:00,2016-1-23 09:30:00,420,2.1,,,8,8,8.25,0.00,0.00,0.00,8.25,Cash,,599,346,599,346
// 1952,2016-1-28 09:00:00,2016-1-28 09:15:00,420,1.3,,504,8,32,7.00,0.00,0.00,0.00,7.00,Cash,,294,113,744,605`;

const csv = require('csvtojson');
const R = require('ramda');
const { v4: uuid } = require('uuid');

const parseDataType = require('./parseDataType');
const isNullish = require('./isNullish');

const extractColumnData = async file => {
  const csvAsJson = await csv().fromString(file.toString('utf8'));

  return R.pipe(
    x => R.keys(x[0]),
    R.map(key => ({
      _id: uuid(),
      value: key,
      dataType: R.reduce((acc, current) => {
        const val = current[key];
        const currentDataType = parseDataType(val);
        return isNullish(val) ? acc ?? 'string' : currentDataType;
      }, undefined)(csvAsJson),
    })),
  )(csvAsJson);
};

module.exports = extractColumnData;
